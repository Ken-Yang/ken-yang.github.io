恩，昨天心血來潮想deploy一個application到GAE (Google App Engine)上，<br />赫然發現GAE現在只支援JDK 7，說實在我很不想升上去！<br />且又想到要在新電腦上裝eclipse plugin for GAE很麻煩，<br />所以把念頭轉到了Amazon Web Service Elastic Compute Cloud (EC2)，<br />又赫然發現我的AWS帳號已經超過一年了...也就是說不能使用free-tier方案！<br /><br />好吧，只好換到heroku上了！<br />heroku比較像是GAE一樣，屬於PaaS平台，<br />但deploy方式比GAE方便多了！也快多了！<br />在Heroku上deploy方式是用git！<br />可以在上面deploy Ruby, node.js, Java, Python...等語言的application！<br /><br />這篇會用python來講解，<br />雖然我最熟java，但heroku預設好像是用maven來當build system，<br />對maven就沒那麼熟！且我實在很懶得設定那很複雜的xml....<br />所以退而求其次選python，<br />而剛好python是使用flask做framework，剛好也玩過這framework，<br />所以就使用python！<br /><br /><br /><br /><span style="color: #e06666; font-size: large;">Step 1：註冊</span><br /><br />先到<a href="https://id.heroku.com/signup/devcenter">https://id.heroku.com/signup/devcenter</a>註冊帳號，<br />蠻方便的，不需要填寫太多資料！<br /><br /><br /><span style="color: #e06666; font-size: large;">Step 2：安裝Heroku toolbelt</span><br /><br />先去<a href="https://toolbelt.heroku.com/">https://toolbelt.heroku.com/ </a>下載toolbelt，<br />因為我是使用mac，所以就下載mac版本的來安裝！<br /><br /><br /><span style="color: #e06666; font-size: large;">Step 3：Login Heroku</span><br /><br />打開你的terminal，<br />輸入下面指令，<br /><pre class="brush: java">heroku login<br /></pre>會要求你輸入heroku上註冊的email及密碼！<br />接著會把你local的ssh key上傳至heroku上去！<br /><br /><br /><span style="color: #e06666; font-size: large;">Step 4：在後台create app</span><br /><br />接著回到heroku的管理後台建立一個app，<br />如下圖，點選下圖中的Create a new app，<br /><span id="goog_67746771"></span><span id="goog_67746772"></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-rQj9LQoTBtk/UpRMRMoEQuI/AAAAAAAAFFc/GxSkzDPe7vw/s1600/Screen+Shot+2013-11-26+at+3.20.49+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-rQj9LQoTBtk/UpRMRMoEQuI/AAAAAAAAFFc/GxSkzDPe7vw/s640/Screen+Shot+2013-11-26+at+3.20.49+PM.png" height="264" width="640" /></a></div><br /><br /><br /><br />接著會popup一個dialog要以輸入這個app名稱（如下圖）！這個app名稱就會變成你的sub-domain，<br />假設我輸入hello-ken，那麼到時候我的app url就會是hello-ken.herokuapp.com！<br />輸入完以後請點選下圖中的create app．<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-lRf0S7DzRlA/UpRMAoxg2xI/AAAAAAAAFFE/WB5PH7lpm3Y/s1600/Screen+Shot+2013-11-26+at+3.21.04+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-lRf0S7DzRlA/UpRMAoxg2xI/AAAAAAAAFFE/WB5PH7lpm3Y/s640/Screen+Shot+2013-11-26+at+3.21.04+PM.png" height="356" width="640" /></a></div><br /><br /><br /><br />這樣就完成create app，接著會跟你說你的app information！如下圖．<br />請把下圖中的git資訊記下來！因為這就是你app的repo了！<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-4hN8y4jZ6v8/UpRMAioGBBI/AAAAAAAAFFI/UoHgXI7a6Tg/s1600/Screen+Shot+2013-11-26+at+3.21.16+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-4hN8y4jZ6v8/UpRMAioGBBI/AAAAAAAAFFI/UoHgXI7a6Tg/s640/Screen+Shot+2013-11-26+at+3.21.16+PM.png" height="512" width="640" /></a></div><br /><br /><span style="color: #e06666; font-size: large;">Step 5：在local create app</span><br /><br />接著你就要把在heroku上的app clone下來，<br />指令如下，<br /><br /><pre class="brush: python">git clone git@heroku.com:hello-ken.git -o heroku<br /></pre><br />clone完成以後，你的目錄底下應該會有一個hello-ken資料夾！<br /><br /><br /><br /><span style="color: #e06666; font-size: large;">Step 6：安裝virtualenv</span><br /><br />virtualenv可以讓你在local模擬獨立的python環境！<br />然後你可以在你的環境中安裝任何python相關package，且不會影響到local system！<br />安裝指令：<br /><pre class="brush: java">curl -O https://pypi.python.org/packages/source/v/virtualenv/virtualenv-1.10.1tar.gz<br />tar xvfz virtualenv-1.10.1.tar.gz<br />cd virtualenv-1.10.1<br />sudo python setup.py install<br /></pre><br /><br /><span style="color: #e06666; font-size: large;">Step 7：建立一個獨立的env</span><br /><br />建立環境<br /><pre class="brush: java">virtualenv venv --distribute<br /></pre><br />activate環境，這裡要注意一點，如果你terminal關掉重開，那麼就要重新去source一次！<br /><pre class="brush: java">source venv/bin/activate<br /></pre><br /><br /><span style="color: #e06666; font-size: large;">Step 8：安裝Flask, gunicorn</span><br /><br />Flask是一個web framework，<br />gunicorn是一個web server．<br /><pre class="brush: java">pip install Flask gunicorn<br /></pre><br /><br /><span style="color: #e06666; font-size: large;">Step 9：寫第一個app</span><br /><br />在這個step就開始寫程式主體，<br /><pre class="brush: python">cd hello-ken<br />vim index.py<br /></pre><br /><br />需搭配Flask的格式！index.py的內容如下！<br />app.route的意思就是，當user request path爲/時，就執行hello這個method，<br /><pre class="brush: python">import os<br />from flask import Flask<br /><br />app = Flask(__name__)<br /><br />@app.route('/')<br />def hello():<br />    return 'Hello World!'<br /></pre><br /><br /><br /><span style="color: #e06666; font-size: large;">Step 10：定義這個app的type</span><br /><br />我們必須要讓heroku知道這個app的type，<br />所以要建立一個檔案（Profile），<br /><pre class="brush: python">vim Profile<br /></pre><br />內容如下：<br /><pre class="brush: python">web: gunicorn index:app<br /></pre><br /><br /><br /><span style="color: #e06666; font-size: large;">Step 11：local test</span><br /><br />完成上面的步驟以後，<br />其實就可以在local端測試，<br />在hello-ken目錄底下指令，<br /><pre class="brush: java">foreman start<br /></pre><br />接著就會在terminal中顯示你的test url，<br />只要打開browser就可以瀏覽了！<br /><br /><br /><span style="color: #e06666; font-size: large;">Step 12：declare requirements</span><br /><br />在這步驟要讓heroku知道我們application的requirement，<br />我們可以透過pip的指令去產生那個requirement檔案，<br />指令如下：<br /><pre class="brush: java">pip freeze &gt; requirements.txt<br /></pre><br /><br /><br /><span style="color: #e06666; font-size: large;">Step 13：deploy app to Heroku</span><br /><br />在這步驟就要把我們剛剛的東西通通push上去heroku了！<br />但我們要先建立.gitignore檔案，<br />把一些不需要push上去的東西拿掉！<br /><pre class="brush: java">venv<br />*.pyc<br /></pre><br /><br />接著就add, commit, push吧！<br /><pre class="brush: java">git add .<br />git commit -m "first commit"<br />git push heroku master<br /></pre><br />順利push完以後，就可以到<span style="color: #e06666;">hello-ken</span>.herokuapp.com看看有沒有成功了！<br />（記得<span style="color: #e06666;">hello-ken</span>要換成你自己申請的app name）<br /><br /><br />接著之後的deploy都是靠git來完成！<br />真的是比GAE方便很多啊！<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />