<span style="font-size: large;"><b>前一篇在講<a href="http://blog.kenyang.net/2011/12/android-c2dm.html">參數說明</a></b></span><br /><span style="font-size: large;"><b>這篇專注於流程說明</b></span><br /><span style="font-size: large;"><b>第三篇在講<a href="http://blog.kenyang.net/2012/03/android-c2dm-sever.html">Server端的實作</a></b></span><br /><span style="font-size: large;"><b>第四篇在講<a href="http://blog.kenyang.net/2012/03/android-c2dm-android.html">Android端的實作</a></b></span><br /><br />Android C2DM的實作步驟大概分為下列三項：<br /><ul><li><b>Enabling C2DM </b>：在Android Device上啟動C2DM準備receive訊息。</li><li><b>Sending a message</b>：Server傳遞訊息至Device</li><li><b>Receiving a message</b>：Android上收來自C2DM Server的訊息</li></ul><div>下面是個三項的說明流程，</div><div><br /></div><div><b><span style="font-size: large;">1. Enabling C2DM</span></b></div><div><ol><li>首先要先啟動一個registration Intent到C2DM的SERVER (com.google.android.c2dm.intent.REGISTER)，且這Intent必須但兩個參數，第一個是<span style="color: red;">SENDER ID</span>，第二個是<span style="color: red;">application ID</span>。<a href="http://blog.kenyang.net/2011/12/android-c2dm.html">參數說明請看這。</a></li><li>如果這個registration成功了，C2DM的Server會回傳(broadcast)一個<span style="color: red;">registration ID</span>，這時候Android applicaiton要把這<span style="color: red;">registration ID</span>先存起來，待會用。(Google可能會一段時間就去refresh這個registration ID）</li><li>完成註冊以及取得<span style="color: red;">resgistration ID</span>以後，Android App必須把此ID傳到自己的server上去。Server一樣得把這ID存起來。</li></ol></div>註：register ID會存活直到你unregister，或者直到Google refresh為止。<br /><br /><br /><br /><div><span style="font-size: large;"><b>2. Sending a message</b></span></div><div><ol><li>在send a message之前，必須確認<b>Android app</b>和<b>Sever</b>上已經有<span style="color: red;"> resgistration&nbsp;&nbsp;ID</span>了，以及Sever必須有<span style="color: red;">ClientLogin authorization token</span>. 至於怎麼取得這個token，可以去看<a href="http://code.google.com/apis/accounts/docs/AuthForInstalledApps.html">Google官網說明</a></li><li>完成上面的以後，首先，Sever必須先send訊息至C2DM Sever上</li><li>Google收到以後，會先存起來，以免Android device是inactive的狀態。</li><li>當Device是online的狀態，Google就會send訊息至device上。</li></ol><div><br /></div></div><br /><br /><div><span style="font-size: large;"><b>3. Receiving a Message</b></span></div><div><ol><li>首先Android OS會先收到這則Message， </li><li>接著Android OS會把這則訊息，會根據package name發送到含有註冊com.google.android.c2dm.intent.RECEIVE的app上去</li><li>最後，該app就會從自己註冊的RECEIVER的Intent裡收到message，就可以處理資料了。</li></ol><br /><br /><span style="font-size: large;"><br /></span></div><span style="font-size: large;"><b>下一篇會講如何去實作。</b></span><br /><span style="font-size: large;"><b><br /></b></span><br /><span style="font-size: large;"><b><br /></b></span><br /><span style="font-size: large;"><b><br /></b></span><br /><br /><br /><br /><br />