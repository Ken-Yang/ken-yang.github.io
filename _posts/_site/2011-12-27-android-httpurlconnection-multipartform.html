在Android實作(模擬)一個form，<br />不管method是用POST或者GET傳遞普通參數(type="text/password/hidden")，都很簡單!<br /><br />那要傳遞type="fiile"的呢?<br />也就是說要上傳一個檔案呢?<br />在Android裡面就稍嫌複雜了一點點點點!<br /><br />這篇將會結合使用camera，將上傳照相完以後的相片!<br />至於怎麼<a href="http://blog.kenyang.net/2010/10/android-camera.html">取得camera的照完相的照片</a>，可以去看我先前PO的教學! <a href="http://blog.kenyang.net/2010/10/android-camera.html">來這看!</a><br />這邊就不多說怎麼取得，就假設已經取得照片了!<br /><br />我們知道在HTML裡，要上傳含有file的參數，<br />&lt;form&gt;必須加上enctype="multipart/form-data"<br /><br />在實作之前，必須說明一下發出這個form的request的格式會怎樣!<br /><pre class="brush: xml">--==============<br />Content-Disposition: form-data; name="image"; filename="image.jpg"<br />Content-Type: image/jpeg<br /><br />!@#!FAWE@#$!A=fj2j12r<br />--==============--<br /><br /></pre><b><span style="font-size: large;"><br /></span></b><br /><b><span style="font-size: large;"><br /></span></b><br /><b><span style="font-size: large;">第一行是<span style="color: #38761d;">--==============</span>，</span></b><br />是由--加上boundary組成的<br />boundary很重要! 是用來區隔參數的!!<br />也就是說，如果裡有很2個參數，<br />那這2個參數前面都會有這一行!!!<br />對了，boundary可以自己設定，但是前提是要告訴server你的boundary是甚麼!<br />等等會說明到! 這裡的boundary假設是===========<br /><br /><br /><b><span style="font-size: large;">第二行Content-Disposition: form-data; name="image"; filename="image.jpg"</span></b><br />這是宣告你的參數名稱，以及他的當案名稱<br /><br /><br /><b><span style="font-size: large;">第三行Content-Type: image/jpeg</span></b><br />是宣告你的file是甚麼型態，因為我們這邊是拿圖片說明，<br />所以就是jpeg。<br /><br /><br /><span style="font-size: large;"><b>第四行是空白行，</b></span><br />在你寫入參數之前，前面一定是一行空白行<br /><br /><br /><b><span style="font-size: large;">第五行!@#!FAWE@#$!A=fj2j12r</span></b><br />這行就是資料行了，開始寫入資料，因為是上傳圖片，<br />所以這樣看一定是亂碼!<br />如果今天type不是file，是text，<br />那麼就會是明文!<br /><br /><br /><span style="font-size: large;"><b>第六行<span style="color: #38761d;">--==============--</span></b></span><br />最後一個參數傳遞完，一定要加上這一行，<br />告訴server，傳完了!<br /><br /><br /><br />了解格式後，現在就來實作，<br />而在Android的實作如下，<br /><pre class="brush: java">	// 先取得圖片<br />	// uriFilePath是當初設定照相完，要存在哪<br />	// 如果忘記可以去看文章上面說的教學文<br />	FileInputStream fileInputStream = new FileInputStream(new File(uriFilePath.getPath()));<br /><br />	final String BOUNDARY 	= "==================================";<br />	final String HYPHENS 	= "--";<br />	final String CRLF 		= "\r\n";<br />	URL url 				= new URL("http://xxx.xxx.xxx/uploadImage");	<br />	HttpURLConnection conn 	= (HttpURLConnection) url.openConnection();<br />	conn.setRequestMethod("POST");						// method一定要是POST<br />	conn.setDoOutput(true);<br />	conn.setDoInput(true);<br />	conn.setUseCaches(false);	<br />	<br />	// 把Content Type設為multipart/form-data<br />	// 以及設定Boundary，Boundary很重要!<br />	// 當你不只一個參數時，Boundary是用來區隔參數的	<br />	conn.setRequestProperty("Content-Type", "multipart/form-data; boundary=" + BOUNDARY);<br />	<br />	<br />	// 下面是開始寫參數<br />	String strContentDisposition = "Content-Disposition: form-data; name=\"image\"; filename=\"image\"";<br />    String strContentType = "Content-Type: image/jpeg";<br />	DataOutputStream dataOS = new DataOutputStream(conn.getOutputStream());<br />	dataOS.writeBytes(HYPHENS+BOUNDARY+CRLF);		// 寫--==================================<br />	dataOS.writeBytes(strContentDisposition+CRLF);	// 寫(Disposition)<br />	dataOS.writeBytes(contentType+CRLF);			// 寫(Content Type)<br />	dataOS.writeBytes(CRLF);		<br />	<br />	int iBytesAvailable = fileInputStream.available();<br />	byte[] byteData = new byte[iBytesAvailable];<br />    int iBytesRead = fileInputStream.read(byteData, 0, iBytesAvailable);<br />	while (iBytesRead &gt; 0) {<br />		dataOS.write(byteData, 0, iBytesAvailable);	// 開始寫內容<br />		iBytesAvailable = fileInputStream.available();<br />		iBytesRead = fileInputStream.read(byteData, 0, iBytesAvailable);<br />	}<br />	dataOS.writeBytes(CRLF);	<br />	dataOS.writeBytes(HYPHENS+BOUNDARY+HYPHENS);	// (結束)寫--==================================--		<br />	file.close();<br />	dataOS.flush();<br />	dataOS.close();<br /><br /></pre><br />這樣完成了!!<br /><br />