---
layout: post
title: android AsyncTask sample
date: '2010-09-02T09:24:00.000+08:00'
author: Ken Yang
tags:
- asynctask
- android
modified_time: '2010-11-06T16:52:11.458+08:00'
blogger_id: tag:blogger.com,1999:blog-866973865356001297.post-608449918426601510
blogger_orig_url: http://blog.kenyang.net/2010/09/android-asynctask-sample.html
---

android 的AsyncTask<br /><br />如果你可能要去download、request一個蠻龐大的網頁或者檔案時，<br /><br />如果是在主要的activity、widget或其他中去作，<br /><br />那麼想必你的activity、widget或其他的UI會像是被lock住!<br /><br />很LAG的感覺!<br /><br />那麼就使用AsyncTask吧!<br /><br />顧名思義，就是非同步排程(應該可以這樣翻)==<br /><br />AsyncTask的好處就是可以在background執行，<br /><br />並不影響前端的UI<br /><br />下面就是實作方法<br /><br />先去new一個class並繼承AsyncTask<br /><br /><pre class="brush: java">public class downloadTask extends AsyncTask&lt;String, Void , String&gt;{<br /> <br /> public static int iFileSize   = 0;<br /> public static double dReadSum   = 0;<br /> public static boolean bIsDownload = false;<br /> <br /> @Override<br /> protected void onProgressUpdate(Void... values) {<br />  <br />  //此method是在呼叫publishProgress()時的才會trigger到的<br />  //可以當配progressBar來使用，這裡不多作說明。<br />  <br />  super.onProgressUpdate(values);<br /><br /> }<br /><br /> <br /> @Override<br /> protected void onPreExecute() {<br />  //此method是在執行doInBackground以前，才會呼叫的<br />  super.onPreExecute();<br /> }<br /> <br /> @Override<br /> protected void onPostExecute(String result) {<br />  //此method是在doInBackground完成以後，才會呼叫的<br />  super.onPostExecute(result);<br />  if (iFileSize == dReadSum){<br />   Log.d("main","下載完成");<br />  }<br />  <br /> }<br /><br />  /*<br />  *注意!strUrlFile是一個array..代表著在呼叫此class時<br />  *可以帶入很多個參數(strUrlFile)，<br />  *如:new downloadTask().execute("http://www.xxx","http://www.xxx");<br />  */ <br /> protected String doInBackground(String... strUrlFile) {<br />     URL urlFileLocation = null;<br />   HttpURLConnection connFile = null;<br />   try {<br />    int iUrlCount = strUrlFile.length;<br />   for (int i =0 ; i &lt; iUrlCount ; i++){<br />    urlFileLocation  = new URL(strUrlFile[i]);   <br />    connFile    = (HttpURLConnection) urlFileLocation.openConnection();   <br />    connFile.setDoInput(true);<br />    <br />    InputStream is = connFile.getInputStream();<br />    iFileSize  = connFile.getContentLength();    //取得檔案大小<br />    <br />    byte[] buffer = new byte[1024];<br />    int len1 = 0;<br />    dReadSum  = 0;<br />    <br />    while ( (len1 = is.read(buffer)) != -1) {<br />     dReadSum += len1;<br />     publishProgress(dReadSum*100/iFileSize);<br />    }<br />   }<br />    <br />    <br />   } catch (Exception e) {<br />    Log.d("main","download---" + e.toString());<br />   }<br />   <br />        return "";<br />     }<br /><br />   <br /> }<br /></pre><br /><br /><br />呼叫此Class就只要一行:<br /><br /><pre class="brush: java"> new downloadTask().execute("http://www.xxx"); <br />/*<br />*注意，參數其實是可以很多個，如下<br />*new downloadTask().execute("http://www.xxx","http://www.xxx");<br />*這樣子此task就會去download兩次<br />*/<br /></pre><br /><br /><br /><br /><br /><br /><br /><br /><br />