---
layout: post
title: 'Android ORM lib: greeDao'
date: '2014-09-24T10:04:00.003+08:00'
author: Ken Yang
tags:
- sqlite
- dao
- android
- greenDao
- db
modified_time: '2014-09-24T10:04:59.335+08:00'
blogger_id: tag:blogger.com,1999:blog-866973865356001297.post-8971010433839783467
blogger_orig_url: http://blog.kenyang.net/2014/09/android-orm-lib-greedao.html
---

<div style="font-size: 15px; line-height: 22px;"><a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a>應該不用多做解釋了，<br />而Android自己本身並沒有ORM的任何lib可用，<br />但有很多熱心的人做了third-party lib，像是<a href="http://ormlite.com/">OrmLite</a>、<a href="http://greendao-orm.com/">greenDao</a>，<br />本篇要講的是greenDao，<br />為什麼我使用greenDao呢？<br />其實網路上不少人在做OrmLite和greenDao的<a href="https://github.com/littleinc/android-orm-benchmark">benchmark</a>，<br />greenDao的performance真是一片倒，<br />也因此我選擇了greenDao，<br />不過說實在的，greenDao一開始的前置作業真是有點麻煩！<br />所以特地寫一篇來記錄！<br /><br /><br /><span style="color: #e06666; font-size: 18px;">1. Clone the repository</span><br /><br />先把greenDao的repository clone下來，<br /><pre class="brush: bash">git clone https://github.com/greenrobot/greenDAO.git<br /></pre><br /><br /><span style="color: #e06666; font-size: 18px;">2. Download jar</span><br /><br />這就是我說的，前置作業很麻煩！<br />有3個必要的jar檔，竟然沒有在repository中！<br />要自行去下載！不過用gradle和marven就不用自行去下載，<br />anyway我用的是eclipse，所以得去下載！<br />&nbsp;&nbsp;&nbsp;&nbsp;1. <a href="http://mvnrepository.com/artifact/org.freemarker/freemarker/2.3.20">freemaker.jar</a><br />&nbsp;&nbsp;&nbsp;&nbsp;2. <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22de.greenrobot%22%20AND%20a%3A%22greendao-generator%22">greendao-generator-1.3.0</a><br />&nbsp;&nbsp;&nbsp;&nbsp;3. <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22de.greenrobot%22%20AND%20a%3A%22greendao%22">greendao-1.3.7.jar</a><br />前面兩個jar是為了build出dao而用的，<br />而後面第三個jar給我們app使用的！<br />在開始之前，先說明一下整體流程，<br />大致上分為兩個步驟，<br />&nbsp;&nbsp;&nbsp;&nbsp;1. 產生 DAO files<br />&nbsp;&nbsp;&nbsp;&nbsp;2. 把DAO files 加到自己的android project中<br /><br /><br /><span style="color: #e06666; font-size: 18px;">3. Generate DAO files</span><br /><br />還記得第一步驟clone下來的repository嗎？<br />repository中有很多份中有很多個project，<br />我們只會用到DaoExampleGenerator，<br />首先先開啟你的eclipse，<br />點選【File】->【Import】->【General】->【Existing Projects into Workspace】->選擇【DaoExampleGenerator】project<br />import進來以後應該會很多error，<br />因為少了2個jar檔，就把【freemaker.jar】和【greendao-generator-1.3.0】import進來吧！<br /><br />接著打開ExampleDaoGenerator這個class，<br />這隻java會幫你generate出4個files，<br />&nbsp;&nbsp;&nbsp;&nbsp;1. DaoMaster<br />&nbsp;&nbsp;&nbsp;&nbsp;2. DaoSession<br />&nbsp;&nbsp;&nbsp;&nbsp;3. Model<br />&nbsp;&nbsp;&nbsp;&nbsp;4. ModelDao<br />DAO就是用來負責db的一切操作, create table, insert, delete, query...etc.<br />model就單純是一個object而已！<br />這四個files都要加到我們的android project之中，<br /><br />接著來說明一下ExampleDaoGenerator裡面在做什麼，(我把原本的code改成我的sample了)<br /><pre class="brush: java">public static void main(String[] args) throws Exception {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 第一個參數是db的版本，第二個是package名稱<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Schema schema = new Schema(1, "net.kenyang.dao"); <br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addNote(schema);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 產生上述說明的files<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new DaoGenerator().generateAll(schema, "../");<br />}<br /><br />private static void addNote(Schema schema) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 這裡可以想像就是增加一個table，有三個欄位，且都是not null<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entity note = schema.addEntity("Note");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;note.addIdProperty();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;note.addStringProperty("title").notNull();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;note.addDateProperty("date").notNull();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;note.addIntProperty("category").notNull();<br />        <br />}<br /><br /></pre><br />接著只要按下run以後，這些files就會被產生出來！<br />接著就把這些files搬移到你的android project當中，<br />請注意！！由於我們上面的schema是"net.kenyang.dao"，<br />那麼你的android project中也要有這個package，並且把這些files放置在該package當中！<br /><br /><br /><span style="color: #e06666; font-size: 18px;">4. Insert, select, delete</span><br /><br />完成上面的前置作業以後，在開始之前，<br />請記得把第二步驟下載的greendao-1.3.7.jar加到android project中，<br />接著就可以開始使用了！<br /><br />insert<br /><pre class="brush: java">DevOpenHelper helper = new DevOpenHelper(this, "expense", null);<br />DaoMaster daoMaster = new DaoMaster(helper.getWritableDatabase());<br />DaoSession daoSession = daoMaster.newSession();<br /><br />NoteDao noteDao = session.getNoteDao();<br />Note note = new Note(null, "hello", new Date(), 0);<br />noteDao.insert(note);<br /></pre><br />select<br /><pre class="brush: java">QueryBuilder&lt;Note&gt; query = noteDao.queryBuilder();<br />// 查詢如果日期小於今天，並且照日期排序<br />query.where(Properties.Date.le(calendar.getTime())).orderDesc(Properties.Date);<br />for (Note n : query.list()) {<br />     Log.e("ken", n.getTitle());       <br />}<br /></pre><br />update<br /><pre class="brush: java">public void fnUpdate(long id) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note note = noteDao.load(id);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;note.setTitle("change title");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noteDao.update(note);<br />}<br /></pre><br />delete <br /><pre class="brush: java">public void fnDelete(long id) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noteDao.deleteByKey(id);<br />}<br /><br /></pre><br />比原本的SQLiteOpenHelper好用太多了啊！<br /><br /><br /><br /><br /><br /></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />