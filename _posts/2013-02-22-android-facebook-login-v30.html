---
layout: post
title: Android Facebook Login (v3.0)
date: '2013-02-22T15:21:00.000+08:00'
author: Ken Yang
tags:
- Facebook Login
- android
modified_time: '2013-02-22T15:23:59.999+08:00'
thumbnail: http://4.bp.blogspot.com/-K_tc8zpI-Fw/UScSM-weCDI/AAAAAAAAEjs/G63E0RlqPzM/s72-c/Screen+Shot+2013-02-22+at+2.40.47+PM.png
blogger_id: tag:blogger.com,1999:blog-866973865356001297.post-5350280325110049992
blogger_orig_url: http://blog.kenyang.net/2013/02/android-facebook-login-v30.html
---

先前介紹過怎麼在Android上實作用Facebook login的機制（<a href="http://blog.kenyang.net/2012/01/androidfacebook-login-api.html">這裡</a>），<br />不過最近發現Facebook SDK改版了很久，先前我介紹的是2.0，<br />現在是3.0了，原本想說是小幅變動，應該不用再寫篇文章來介紹！<br />但看了一下<a href="https://developers.facebook.com/docs/tutorials/androidsdk/3.0/upgrading-from-2.0-to-3.0/">Change log</a>，發現變很大！<br /><br />而且看了一下Facebook SDK的source code，也發現大幅變更了！<br />此外，現在Facebook SDK有import&nbsp;android-support-v4.jar，<br />原因是因為在Android 3.x以上的機器會使用到Fragments......<br />為了backward compatibility，向下支援2.x，所以會import.....<br />可想而知，也多了很多東西，<br />先前2.0我在用的時候，也頂多6個Class....<br />現在是多了更多，且好多個package，甚至多了很多style.xml！<br />所以如果現在用我之前的方法，直接把Class拉進去我們的project，<br />那麼一定會出現很多error，因為現在不只要拉code了，還要拉很多圖片，style.xml！！<br />所以還是用最正統的方法吧！直接include近來！<br /><br /><br /><h2><b><span style="font-size: large;">1. 首先先去下載SDK (<a href="https://developers.facebook.com/android/">載點</a>）</span></b></h2><br /><b><span style="font-size: large;">2. 解壓縮</span></b><br /><br /><br /><span style="font-size: large;"><b>3. import Facebook SDK source code進來</b></span><br />import進來以後會看到很多個project，基本上請勾選FacebookSDK就好！<br />就是下圖中的第二個！<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-K_tc8zpI-Fw/UScSM-weCDI/AAAAAAAAEjs/G63E0RlqPzM/s1600/Screen+Shot+2013-02-22+at+2.40.47+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="568" src="http://4.bp.blogspot.com/-K_tc8zpI-Fw/UScSM-weCDI/AAAAAAAAEjs/G63E0RlqPzM/s640/Screen+Shot+2013-02-22+at+2.40.47+PM.png" width="640" /></a></div><br /><br /><br /><span style="font-size: large;"><b>4. 建立一個新的Project</b></span><br />建好以後在Project上點選右鍵-&gt;Properties-&gt;Android，<br />會看到下圖，<br />請在Library的欄位點選Add按鈕，<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-GyvhXdxRhdg/UScS5UbcfEI/AAAAAAAAEj4/eyDsqqUi3mk/s1600/Screen+Shot+2013-02-22+at+2.44.12+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-GyvhXdxRhdg/UScS5UbcfEI/AAAAAAAAEj4/eyDsqqUi3mk/s400/Screen+Shot+2013-02-22+at+2.44.12+PM.png" width="373" /></a></div><br /><br />按完以後，會彈出一個視窗，應該會有一個Project供你選擇，<br />就是下圖中的FacebookSDK，請選擇該Project．<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-JYv6LYphvFA/UScS5SPRMdI/AAAAAAAAEj0/kWmMfbgQ3zQ/s1600/Screen+Shot+2013-02-22+at+2.44.29+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-JYv6LYphvFA/UScS5SPRMdI/AAAAAAAAEj0/kWmMfbgQ3zQ/s400/Screen+Shot+2013-02-22+at+2.44.29+PM.png" width="373" /></a></div><br />選完以後就完成import進來了，就可以準備來寫code，<br />但寫code之前，還要做一些必要的設定...<br /><br /><br /><span style="font-size: large;"><b>5. &nbsp;產生hashkey </b></span><br />產生的方法，在<a href="http://blog.kenyang.net/2012/01/androidfacebook-login-api.html">前一篇文章</a>就講過！<br />詳細的參數說明可以看那邊！<br />基本上你複製下面的指令即可完成！(only on mac)<br /><pre class="brush: java">keytool -exportcert -alias androiddebugkey -keystore ~/.android/debug.keystore | openssl sha1 -binary | openssl base64<br /></pre>下了這行指令以後，他會要你敲密碼！<br />基本上不要敲，直接按下enter即可！<br />產生key以後，把key複製下來！<br /><br />然後去到你的facebook app後台(https://developers.facebook.com/apps)<br />然後Create new app,<br />Create完成以後，會看到下圖！<br />請看到下圖中的三個橘色框框，<br />第一個是App ID，請一定要記起來！<br />第二個是key hash，把你剛剛產生的hashkey貼上去吧！<br />第三個是Facebook Login（以前沒有），請把它enable吧！<br /><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-wBFq5eaJMUI/UScV7_X-4YI/AAAAAAAAEkg/JE5bZXQahG4/s1600/Screen+Shot+2013-02-22+at+2.55.10+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://1.bp.blogspot.com/-wBFq5eaJMUI/UScV7_X-4YI/AAAAAAAAEkg/JE5bZXQahG4/s640/Screen+Shot+2013-02-22+at+2.55.10+PM.png" width="635" /></a></div><br /><br /><br /><b><span style="font-size: large;">6. 設定</span></b><br />首先先打開/res/values/strings.xml！<br />然後新增一個element，叫做app_id！<br />如下：<br /><pre class="brush: xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br />&lt;resources&gt;<br />	&lt;string name="app_id"&gt;438511916228708&lt;/string&gt; <br />&lt;/resources&gt;<br /></pre><br />接著打開AndroidManifest.xml，<br />新增一個permission！如下：<br /><pre class="brush: xml">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;<br /></pre><br />然後在新增一個activity，如下<br /><pre class="brush: xml">&lt;activity android:name="com.facebook.LoginActivity"/&gt;<br /></pre><br />新增一個meta-data，如下<br /><pre class="brush: xml">&lt;meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/app_id"/&gt;<br /></pre><br />完成上述三個步驟以後就可以來寫code了！<br /><br /><br /><br /><b><span style="font-size: large;">7. 開始寫code</span></b><br /><br />首先先在onActivityResult進行丟丟登入結果的動作，<br />如下：<br /><pre class="brush: java">	@Override<br />	protected void onActivityResult(int requestCode, int resultCode, Intent data) {<br />		super.onActivityResult(requestCode, resultCode, data);<br />		Session.getActiveSession().onActivityResult(this, requestCode,resultCode, data);<br />	}<br /></pre>要寫在onActivityResult的原因是因為，你要用Facebook login時，都會跳到另一個Activity（如上的LoginActivity）進行輸入email &amp; pwd！<br />輸入完以後，才會回到我們自己的Activity！<br /><br />接下來要寫呼叫Login的，<br />你可以直接寫在onCreate的地方，就是一開這個app就進行fb登入！<br />如下：<br /><pre class="brush: java">	@Override<br />	protected void onCreate(Bundle savedInstanceState) {<br />		super.onCreate(savedInstanceState);<br />		setContentView(R.layout.activity_main);<br />		Session.openActiveSession(this, true, new Session.StatusCallback() {<br />			@Override<br />			public void call(Session session, SessionState state,Exception exception) {<br />				if (session.isOpened()) {<br />					Log.e("kenyang",session.getAccessToken()); // get token<br />				}<br />			}<br />		});<br />	}<br /></pre><br /><br />只要有取得token，這樣就完成登入了！！<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />