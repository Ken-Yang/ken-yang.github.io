---
layout: post
title: 'Android: startService vs bindService'
date: '2012-11-25T23:26:00.001+08:00'
author: Ken Yang
tags:
- service
- android
modified_time: '2013-03-29T20:46:50.078+08:00'
blogger_id: tag:blogger.com,1999:blog-866973865356001297.post-4268821239390880133
blogger_orig_url: http://blog.kenyang.net/2012/11/android-startservice-vs-bindservice.html
---

這篇要說明<br /><ul><li>startService</li><li>bindService</li></ul>這兩者的差別！<br /><br />其實在我之前的筆記有關<a href="https://developer.android.com/guide/components/services.html">Service</a>的文章，都是使用startService！<br />並沒有使用bindService！<br />一方面是因為startService簡單很多！<br />再來也是最近才發現有bindService！<br />應該是說我原本以為startService的行為與bindService差不多！<br />但實際找答案以後才知道不是這樣的！<br /><br /><br />這裡就不多作說明如何使用startService或者bindService！<br />主要會說明這兩者差異性！<br />如果要看如何使用可以看之前的筆記：<br /><br /><ol><li><a href="http://blog.kenyang.net/2012/03/android-c2dm-android.html">Android C2DM (四)：實作之Android篇</a></li><li><a href="http://blog.kenyang.net/2010/11/android-detect-screen-on-and-screen-off.html">android detect screen on and screen off</a></li><li><a href="http://blog.kenyang.net/2010/08/android-sdcard.html">android 偵測 sdcard</a></li></ol><div><br /></div><br />先去看Google的定義，對於startService，Google定義如下<br /><blockquote><b>Once started, a service can run in the background indefinitely, even if the component that started it is destroyed. Usually, a started service performs a single operation and does not return a result to the caller. For example, it might download or upload a file over the network. When the operation is done, the service should stop itself.</b></blockquote>簡言之用startService啟動，這個service是不會跟隨著啓動他的component消滅！且原則上是不能與UI互動的！（原則上）<br /><br /><br />而對於bindService，定義如下：<br /><blockquote><b>A bound service offers a client-server interface that allows components to interact with the service, send requests, get results, and even do so across processes with interprocess communication (IPC). A bound service runs only as long as another application component is bound to it. Multiple components can bind to the service at once, but when all of them unbind, the service is destroyed.</b></blockquote>用bindService起來的話，則此service可以跟該component進行溝通！甚至可以做到 IPC！<br /><br />小結：<br />bindService和startService最主要的差異在於其本身的lifecycle！<div>以及bindService可以用來做IPC！簡單的說就是可以讓你的service和UI溝通！<br /><br /></div><div>這裡就用一個project來說明吧！<br /><div><br />先建立一個new project！<br />在這project中建立一個Activity，並指定它為launcher！<br />然後在建立一個Service！內如如下：<br /><pre class="brush: java">public class Services extends Service {<br /><br /> @Override<br /> public IBinder onBind(Intent intent) {<br />  // TODO Auto-generated method stub<br />  Log.d("TestService","onBind");<br />  return null;<br /> }<br /> <br /> @Override<br /> public int onStartCommand(Intent intent, int flags, int startId) {<br />  Log.d("TestService","onStartCommand");<br />  return super.onStartCommand(intent, flags, startId);<br /> }<br /> @Override<br /> public ComponentName startService(Intent service) {<br />  Log.d("TestService","startService");<br />  return super.startService(service);<br /> }<br /> <br /> @Override<br /> public void onCreate() {<br />  super.onCreate();<br />  Log.d("TestService","onCreate");<br /> }<br /> <br /> @Override<br /> public void onDestroy() {<br />  super.onDestroy();<br />  Log.d("TestService","onDestroy");<br /> }<br /><br /> @Override<br /> public boolean onUnbind(Intent intent) {<br />  Log.d("TestService","onUnbind");<br />  return super.onUnbind(intent);<br /> }<br /> <br />}<br /></pre><br />可以看到上面的Service中並沒有做任何處理！<br />只有簡單的Log！<br />目的只是要讓我們瞭解startService和bindService的lifecycle差異性！<br /><br />首先先來講startService，<br />我們先在onCreate中start！如下：<br /><pre class="brush: java">@Override<br /> protected void onCreate(Bundle savedInstanceState) {<br />  super.onCreate(savedInstanceState);<br />  <br />  startService(new Intent(this,Services.class));<br /> }<br /></pre><br />然後按下run，在開啟DDMS來觀看log！<br />會發現印出了”onCreate"->"onStartCommand"！<br /><br />這時候按下back鍵來destroy這個activity，你會發現什麼都沒有印出來！<br />也就是說這個service仍在background執行！（你得手動stop）<br /><br />這時候我們換成bindService來看看，如下：<br /><pre class="brush: java">@Override<br /> protected void onCreate(Bundle savedInstanceState) {<br />  super.onCreate(savedInstanceState);<br />  <br />  bindService(new Intent(this,Services.class),null,Context.BIND_AUTO_CREATE);<br /> }<br /></pre><br />一樣按下run！再看一下ＬＯＧ！<br />會發現印出“onCreate"->"onBind"！<br /><br />再按下back鍵，會發現...印出了！<br />“onUnbind"->"onDestroy"<br /><br /><br /><br />總結上面兩項的差異，<br />會發現使用bindService時，<br />這個service的lifecycle是跟隨著bind它的object！<br />所以當該object被destroy，自然而然這個service也被destroy！<br /><br />而使用startService，<br />就不是這樣了！這個service就是獨立的！不屬於任何一個object！<br />得靠stopService來停止！（任何一個Activity中都可以stop）<br /><br /><br />註：bindService的使用方式比較特別！<br />多帶了幾個參數！<br />在這個例子我們第二個參數設為null！<br />其實這參數是要傳入一個ServiceConnection的物件！<br />而ServiceConnection是一個Interface，這個Interface中<br />會有兩個callback function！<br />主要是用來monitor 這個service的state！<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></div></div>