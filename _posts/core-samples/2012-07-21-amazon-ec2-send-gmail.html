---
layout: post
title: 在Amazon EC2-  send gmail 問題
date: '2012-07-21T15:40:00.000+08:00'
author: Ken Yang
tags:
- ec2
- java
modified_time: '2012-07-21T15:40:01.294+08:00'
thumbnail: http://1.bp.blogspot.com/-EAIGVKFlLZ4/UApcPcfDdNI/AAAAAAAAAxY/QBBUCnqIQpk/s72-c/Untitled.png
blogger_id: tag:blogger.com,1999:blog-866973865356001297.post-1169547530638574056
blogger_orig_url: http://blog.kenyang.net/2012/07/amazon-ec2-send-gmail.html
---

用Java寄MAIL不是這篇的重點，<br />反正主要是用JavaMail API就是了!<br />code 如下，就不多做說明：<br /><pre class="brush: java">            final String MAIL_HOST = "smtp.gmail.com";   // gmail的smtp<br />            final String GMAIL_ACCOUNT = "XXXXX@gmail.com";  //gmail account<br />            final String GMAIL_PASSWORD = "XXXXX";    // gmail pwd<br />            final String strRecipients = "xxx@gmail.com"; // 收件人<br />            final String strSender = "ejustmake@gmail.com";  // 寄件人名稱<br />            Security.addProvider(new com.sun.net.ssl.internal.ssl.Provider());<br /><br />            Properties props = new Properties();<br />            props.setProperty("mail.transport.protocol", "smtp");<br />            props.setProperty("mail.host", MAIL_HOST);<br />            props.put("mail.smtp.auth", "true");<br />            props.put("mail.smtp.port", "465");<br />            props.put("mail.smtp.socketFactory.port", "465");//smtp PORT 528好像也可以<br />            props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");<br />            props.put("mail.smtp.socketFactory.fallback", "false");<br />            props.setProperty("mail.smtp.quitwait", "false");<br />            <br />            <br />   // Authenticate的動作 <br />            Session session = Session.getDefaultInstance(props,<br />                    new javax.mail.Authenticator() {<br />                        protected PasswordAuthentication getPasswordAuthentication() {<br />                            String account = GMAIL_ACCOUNT;<br />                            String pass = GMAIL_PASSWORD;<br />                            return new PasswordAuthentication(account, pass);<br />                        }<br />            });<br />            <br /><br />            MimeMessage message = new MimeMessage(session);<br />            message.setstrSender(new InternetAddress(strSender));<br />            message.setSubject("Mail標題", "UTF-8");<br />            message.setContent(strBody, "text/html;charset=utf-8");//這裡用text/html就可以傳網頁的內容！<br /><br />            message.setstrRecipients(Message.RecipientType.TO, InternetAddress.parse(strRecipients));<br />            Transport.send(message);<br /><br /></pre><br /><br />然後這段code在任何一台host上，甚至local上都可以run，<br />但是打包成war搬上去ec2以後就出現AuthenticationFail問題.....<br />恩，主要問題是被Google擋住了！<br />因為我用的帳號平常是在台灣進行登入！<br />可是搬上去ec2以後...因為主機是在美國，<br />所以變成IP變成從美國登入...<br />會被擋住，但是GOOGLE會發一封MAIL給你，<br />內容如下圖，反正就是詢問這是不是你，如果是你，<br />就點下圖中的紅色框框，點了以後按照步驟做，<br />然後再用你的應用程式登入一次，就成功了！<br /><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-EAIGVKFlLZ4/UApcPcfDdNI/AAAAAAAAAxY/QBBUCnqIQpk/s1600/Untitled.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="348" src="http://1.bp.blogspot.com/-EAIGVKFlLZ4/UApcPcfDdNI/AAAAAAAAAxY/QBBUCnqIQpk/s640/Untitled.png" width="640" /></a></div><br /><br /><br /><br /><br /><br />