
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>How to create a customized Ubuntu ISO?</title>
    
    <meta name="author" content="Name Lastname">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes//bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes//bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes//bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes//css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Jekyll Bootstrap</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">Tags</a></li>
      	
      
    
  



          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>How to create a customized Ubuntu ISO? </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>13 April 2015</span>
    </div>
    <div class="content">
      <div style="font-size: 15px; line-height: 22px;">這篇要講怎麼客製化你自己想要的ubuntu ISO，<br />會講解一些<a href="http://en.wikipedia.org/wiki/Preseed">preseed</a>的參數，<br />preseed file是debian系列的automation config，而redhat系列就是用kickstart，<br />debian系列就是根據preseed file去進行安裝．<br />因此ubuntu也是用preseed，當然ubuntu也可以用kickstart，只是“似乎”支援沒有那麼好!?<br />題外話，雖然說preseed file是debian的標準格式，<br />但有一點要記得，debian自己本身的preseed file，並不是每一個command，ubuntu都能接受！<br /><br /><br /><span style="color: #e06666; font-size: 18px;">1. Download ubuntu ISO</span><br /><br />首先，你要有一個ubuntu的ISO，<br />這裏我選用ubuntu 12.04的ISO，<br /><pre class="brush: bash">wget http://releases.ubuntu.com/12.04.5/ubuntu-12.04.5-server-amd64.iso<br /></pre><br /><br /><span style="color: #e06666; font-size: 18px;">2. Mount the ISO</span><br /><br />接著要把ISO內的東西，先mount起來，接著再copy出來，<br /><pre class="brush: bash">mkdir -p /mnt/tmp /mnt/iso<br />mount -o loop ./ubuntu-12.04.5-server-amd64.iso /mnt/tmp<br />rsyn -av /mnt/tmp /mnt/iso<br />umount /mnt/tmp<br /></pre><br /><span style="color: #e06666; font-size: 18px;">3. Add boot menu option</span><br /><br />因為要客製化你自己的ISO，<br />所以我們要在boot menu中，新增一個屬於我們自己的menu，<br />首先先開啟這個isolinux/txt.cfg檔案<br /><pre class="brush: bash">vim /mnt/iso/isolinux/txt.cfg<br /></pre><br />打開以後應該會看到下面的內容，<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-VdB_0wKMjWA/VSo0ZnuY9hI/AAAAAAAAFjY/2TZzIfVE7Is/s1600/Screen%2BShot%2B2015-04-12%2Bat%2B4.56.41%2BPM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-VdB_0wKMjWA/VSo0ZnuY9hI/AAAAAAAAFjY/2TZzIfVE7Is/s640/Screen%2BShot%2B2015-04-12%2Bat%2B4.56.41%2BPM.png" /></a></div><br />我們就在label install之前新增一筆boot menu，<br />內容如下，<br /><pre class="brush: bash">label YourCustomizedISO<br />    menu label ^Customized ISO<br />    kernel /install/vmlinuz<br />    append  file=/cdrom/preseed/customized.seed initrd=/install/initrd.gz quiet --<br /></pre><br /><br /><span style="color: #e06666; font-size: 18px;">4. Add pressed file</span><br /><br />接著就要新增一個客製化的preseed file，<br /><pre class="brush: bash">vim /mnt/iso/preseed/customized.seed<br /></pre><br />內容如下，這份preseed讓你可以不用輸入任何按鍵就進行自動安裝！<br />我覺得還蠻淺顯易懂的，每個section都有標註是在做什麼，<br />比較值得注意的是『Advance command』這個section，<br />這section裡面放的是，『安裝完ubuntu以後，要做些什麼事情。』<br />但是如果你想要在『安裝之前』或者『partition之前或者之後』做些事情，都是可以的。<br />只不過這個example，我們是在『安裝完ubuntu以後』。<br /><br />『preseed/late_command』就是『安裝完ubuntu以後』的意思。<br />不過這邊可能大家會覺得很奇怪，為什麼在late_command中，<br />一開始要cp至/target目錄？/target目錄又是什麼？<br />大家在安裝ubuntu的時候，可以change console一下，這時候cd至/target底下，<br />你會發現其實裡面就是你真正ubuntu安裝的位置！<br />那/target外面的東西是誰的呢(bin, lib, etc,....)？<br />其實是busybox的，所以你一定得把你想要的東西搬到/target裡面，<br />這樣在你安裝完以後，該東西才會存在。<br />接著還有另一段奇怪的command：in-target，<br />『in-target』，簡單的說就是chroot /target而已，<br />你也可以用chroot /target去取代『in-target』。<br /><br /><pre class="brush: bash">####### Localization #######<br />d-i debian-installer/locale string en_US<br />d-i debian-installer/language string en<br />d-i debian-installer/country string US<br /><br /><br />####### Keyboard selection #######<br />d-i console-setup/ask_detect boolean false<br />d-i console-setup/layoutcode string us<br />d-i console-setup/modelcode string pc105<br />d-i kbd-chooser/method string us<br />d-i keyboard-configuration/layout string USA<br />d-i keyboard-configuration/variant string USA<br /><br />####### Network configuration #######<br />#d-i netcfg/choose_interface select auto<br />d-i netcfg/choose_interface select eth0<br />d-i netcfg/get_hostname string ubuntu<br />d-i netcfg/get_domain string<br /># configure the network manually<br />#d-i netcfg/disable_autoconfig boolean true<br /># configure the network automatically<br />d-i netcfg/get_nameservers string 8.8.8.8<br />d-i netcfg/get_ipaddress string 172.16.131.138<br />d-i netcfg/get_netmask string 255.255.255.0<br />d-i netcfg/get_gateway string 172.16.131.2<br />d-i netcfg/confirm_static boolean true<br /><br />####### Apt setup #######<br />d-i apt-setup/security-updates boolean false<br />d-i apt-setup/restricted boolean false<br />d-i apt-setup/universe boolean false<br />d-i apt-setup/backports boolean false<br />d-i apt-setup/security boolean false<br />d-i mirror/http/proxy string<br /><br />####### Base system installation #######<br />d-i debian-installer/splash boolean false<br />d-i base-installer/install-recommends boolean true<br />d-i base-installer/kernel/altmeta string lts-saucy<br /><br />####### Clock and time zone setup #######<br />d-i clock-setup/utc boolean true<br />d-i clock-setup/utc-auto boolean true<br />d-i time/zone string UTC<br /><br />####### Boot loader installation #######<br />d-i finish-install/reboot_in_progress note<br />d-i grub-installer/only_debian boolean true<br />d-i grub-installer/with_other_os boolean true<br /><br />####### Partitioning using LVM #######<br />d-i partman-auto-lvm/guided_size string max<br />d-i partman-auto/choose_recipe select atomic<br />d-i partman-auto/method string lvm<br />d-i partman-lvm/confirm boolean true<br />d-i partman-lvm/confirm boolean true<br />d-i partman-lvm/confirm_nooverwrite boolean true<br />d-i partman-lvm/device_remove_lvm boolean true<br />d-i partman/choose_partition select finish<br />d-i partman/confirm boolean true<br />d-i partman/confirm_nooverwrite boolean true<br />d-i partman/confirm_write_new_label boolean true<br /><br />####### User #######<br />d-i passwd/root-login boolean true<br />d-i passwd/root-password password 1234<br />d-i passwd/root-password-again password 1234<br />d-i user-setup/allow-password-weak boolean true<br /># create user or not<br />d-i passwd/make-user boolean false<br />#d-i user-setup/encrypt-home boolean false<br />#d-i passwd/user-fullname string ken<br />#d-i passwd/username string ken<br />#d-i passwd/user-password password 123456<br />#d-i passwd/user-password-again password 123456<br /><br />####### Package selection #######<br />d-i pkgsel/include string openssh-server vim<br />d-i pkgsel/install-language-support boolean false<br />d-i pkgsel/update-policy select none<br />d-i pkgsel/upgrade select none<br /><br />tasksel tasksel/first multiselect standard, ubuntu-server<br /><br />####### Advance command #######<br />d-i preseed/late_command string \<br />cp /cdrom/preseed/setup-something.bash /target/tmp/setup-something.bash && in-target chmod +x /tmp/setup-something.bash && in-target /bin/bash /tmp/setup-something.bash<br /><br /></pre><br /><br /><br /><span style="color: #e06666; font-size: 18px;">5. Make an ISO</span><br /><br />完成上面的步驟後，<br />剩下最後一步就完成了，<br />把剛剛copy出來的內容，在包成一個ISO就好了。<br /><pre class="brush: bash">mkisofs -r -R -J -T -v -b isolinux/isolinux.bin -no-emul-boot -boot-load-size 4 -boot-info-table -z -iso-level 4 -c isolinux/isolinux.cat -o custom.iso /mnt/iso<br /></pre><br />大概等個20秒以後，就會看到一個custom.iso，就代表你成功了！<br /><br /><br /><br /><br /><br /><br /><br /><br /></div><br />
    </div>

    

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#ubuntu-ref">ubuntu <span>5</span></a></li>
     
    	<li><a href="/tags.html#12.04-ref">12.04 <span>1</span></a></li>
     
    	<li><a href="/tags.html#customized-ref">customized <span>1</span></a></li>
     
    	<li><a href="/tags.html#linux-ref">linux <span>3</span></a></li>
     
    	<li><a href="/tags.html#ISO-ref">ISO <span>1</span></a></li>
     
    	<li><a href="/tags.html#preseed-ref">preseed <span>1</span></a></li>
    
  



    </ul>
    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/2014/11/24/mogilefs-distributed-filesystem" title="MogileFS: Distributed filesystem">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next"><a href="/2015/06/17/how-to-run-simple-apache-spark" title="How to run a simple Apache Spark application? (Ubuntu 12.04)">Next &raquo;</a></li>
    
    </ul>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2015 Name Lastname
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
        </p>
      </div>
    </div>

    





    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes//bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

